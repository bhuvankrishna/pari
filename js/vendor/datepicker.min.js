+function(t){Date.prototype.getDays=function(){return new Date(this.getFullYear(),this.getMonth()+1,0).getDate()};var e=["January","February","March","April","May","June","July","August","September","October","November","December"],a=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],d=["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],n=function(a,d){function n(t){var e=new Date(s.date),a=e.getMonth(),d=e.getFullYear();e.setDate(1),"days"===s.viewMode?e.setMonth(a+("next"===t?1:-1)):e.setFullYear(d+("next"===t?1:-1)),s.date=e,s.create(s.viewMode)}if(this.calendar=t(a),this.today=new Date,this.options=d,""===this.calendar.prev().val())this.date=new Date;else{var r=this.reformatDate(this.calendar.prev().val());this.date=isNaN(parseInt(r.m))?new Date(r.m+" "+r.d+", "+r.y):new Date(r.y,r.m-1,r.d)}this.viewMode="days",this.selected=this.date.getMonth()+1+"/"+this.date.getDate()+"/"+this.date.getFullYear(),this.minDate=this.calendar.prev().data("mindate"),this.maxDate=this.calendar.prev().data("maxdate"),"calendar"===d.mode?this.tHead=t('<thead><tr><th id="prev">&lsaquo;</th><th colspan="5" id="currM"></th><th id="next">&rsaquo;</th></tr><tr><th>Su</th><th>Mo</th><th>Tu</th><th>We</th><th>Th</th><th>Fr</th><th>Sa</th></tr></thead>'):"datepicker"===d.mode&&(this.tHead=t('<thead><tr><th id="prev">&lsaquo;</th><th colspan="5" id="currM"></th><th id="next">&rsaquo;</th></tr><tr><th>S</th><th>M</th><th>T</th><th>W</th><th>T</th><th>F</th><th>S</th></tr></thead>')),this.tHead.find("#currM").text(e[this.today.getMonth()]+" "+this.today.getFullYear()),this.calendar.prepend(this.tHead);var s=this;this.calendar.on("click","#next",function(){n("next")}).on("click","#prev",function(){n("prev")}).on("click","#today",function(){s.viewMode="days";var t=new Date(s.date),e=new Date(s.today);t.toString()!=e.toString()&&(s.date=e),s.create("days")}).on("click",".date, .pMDate, .nMDate",function(){var e=t(this).hasClass("pMDate"),a=t(this).hasClass("nMDate"),d=t(this).text(),n=s.date.getMonth(),r=s.date.getFullYear(),i="today"===s.minDate?new Date(s.today.getFullYear(),s.today.getMonth(),s.today.getDate()):new Date(s.minDate),o="today"===s.maxDate?new Date(s.today.getFullYear(),s.today.getMonth(),s.today.getDate()):new Date(s.maxDate);e?r=0===n?r-1:r:a&&(r=n+2===13?r+1:r),e?n=0===n?"12":n:a?n=n+2===13?"1":n+2:n+=1;var h=new Date(r,n-1,d);if(!(s.minDate&&h<i||s.maxDate&&h>o))return s.selected=n+"/"+d+"/"+r,"datepicker"===s.options.mode&&(s.calendar.find("td").removeClass("selected"),t(this).addClass("selected")),s.selectDate(),!0}).on("click","#currM",function(){s.viewMode="months",s.create(s.viewMode)}).on("click",".month",function(e){s.viewMode="days";var a=new Date(s.date);s.calendar.find("#currM").text();a.setMonth(t(e.currentTarget).attr("num")),s.date=a,s.create(s.viewMode)}),this.create(this.viewMode)};n.prototype={constructor:n,setDate:function(){var t=this,e=t.reformatDate(t.calendar.prev().val()),a=isNaN(parseInt(e.m))?new Date(e.m+" "+e.d+", "+e.y):new Date(e.y,e.m-1,e.d);t.selected=a.getMonth()+1+"/"+a.getDate()+"/"+a.getFullYear(),t.selectDate(),t.date=a,t.create(t.viewMode)},selectDate:function(){var e=this,a=e.formatDate(e.options.format),d=t.Event("selectdate",{date:a});e.calendar.trigger(d)},reformatDate:function(a){var d=this.options.format,n=(d.match(/d/g)||[]).length,r=(d.match(/m/g)||[]).length,s=(d.match(/y/g)||[]).length,i=4==r,o=1==r,h=1==n,l=a.length,c=d.indexOf("m"),u=d.indexOf("d"),p=d.indexOf("y"),m="",g="",f="";if(i){var y=-1;t.each(e,function(t,e){a.indexOf(e)>=0&&(y=t)}),m=e[y],u=(d=d.replace("mmmm",m)).indexOf("d"),p=d.indexOf("y")}else if(!h&&!o||h&&!o&&c<u)m=a.substr(c,r);else{var D=d.lastIndexOf("m"),v=d.substring(c-1,c),M=d.substring(D+1,D+2);m=D==d.length-1?a.substring(a.indexOf(v,c-1)+1,l):0==c?a.substring(0,a.indexOf(M,c)):a.substring(a.indexOf(v,c-1)+1,a.indexOf(M,c+1))}if(!h&&!o||!h&&o&&u<c)g=a.substr(u,n);else{var x=d.lastIndexOf("d");v=d.substring(u-1,u),M=d.substring(x+1,x+2),g=x==d.length-1?a.substring(a.indexOf(v,u-1)+1,l):0==u?a.substring(0,a.indexOf(M,u)):a.substring(a.indexOf(v,u-1)+1,a.indexOf(M,u+1))}if(!o&&!h||o&&h&&p<c&&p<u||!o&&h&&p<u||o&&!h&&p<c)f=a.substr(p,s);else{v=d.substring(p-1,p);f=a.substr(a.indexOf(v,p-1)+1,s)}return{m:m,d:g,y:f}},formatDate:function(t){var d=this,n=new Date(d.selected),r=n.getDate(),s=n.getMonth(),i=n.getFullYear();return t.replace(/(yyyy|yy|mmmm|mmm|mm|m|dd|d)/gi,function(t){switch(t.toLowerCase()){case"d":return r;case"dd":return r<10?"0"+r:r;case"m":return s+1;case"mm":return s+1<10?"0"+(s+1):s+1;case"mmm":return a[s];case"mmmm":return e[s];case"yy":return i.toString().substr(2,2);case"yyyy":return i}})},create:function(n){var r=this,s=[],i=t("<tbody></tbody>"),o=new Date(r.date.getFullYear(),r.date.getMonth(),r.date.getDate()),h=r.date.getDays(),l=1,c=1,u=r.selected.split("/"),p=new Date(u[2],u[0]-1,u[1]),m=new Date(r.today.getFullYear(),r.today.getMonth(),r.today.getDate()),g="today"===r.minDate?m:new Date(r.minDate),f="today"===r.maxDate?m:new Date(r.maxDate);if(r.calendar.empty(),"days"===n){"calendar"===r.options.mode?r.tHead=t('<thead><tr><th id="prev">&lsaquo;</th><th colspan="5" id="currM"></th><th id="next">&rsaquo;</th></tr><tr><th>Su</th><th>Mo</th><th>Tu</th><th>We</th><th>Th</th><th>Fr</th><th>Sa</th></tr></thead>'):"datepicker"===r.options.mode&&(r.tHead=t('<thead><tr><th id="prev">&lsaquo;</th><th colspan="5" id="currM"></th><th id="next">&rsaquo;</th></tr><tr><th>S</th><th>M</th><th>T</th><th>W</th><th>T</th><th>F</th><th>S</th></tr></thead>')),r.tHead.find("#currM").text(e[r.date.getMonth()]+" "+r.date.getFullYear()),r.calendar.append(r.tHead);for(T=1;T<=6;T++){for(var y=[t("<td></td>"),t("<td></td>"),t("<td></td>"),t("<td></td>"),t("<td></td>"),t("<td></td>"),t("<td></td>")];l<=h;){o.setDate(l);var D=o.getDay();if(o.getTime()==m.getTime()&&y[D].attr("id","currDay"),(r.minDate&&o<g||r.maxDate&&o>f)&&y[D].addClass("disabled"),"datepicker"===r.options.mode&&o.getTime()==p.getTime()&&y[D].addClass("selected"),1===T&&0===D)break;if(!(D<6)){y[D].html("<span>"+l+++"</span>").addClass("date");break}y[D].html("<span>"+l+++"</span>").addClass("date")}if(1===T||T>4)if(1===T)for(var v=new Date(r.date.getFullYear(),r.date.getMonth()-1,1),M=(v.getMonth(),v.getDays()),x=6;x>=0;x--)""===y[x].text()&&(v.setDate(M),y[x].html("<span>"+M--+"</span>").addClass("pMDate"),(r.minDate&&v<g||r.maxDate&&v>f)&&y[x].addClass("disabled"),"datepicker"===r.options.mode&&v.getTime()==p.getTime()&&y[x].addClass("selected"));else if(T>4)for(var w=new Date(r.date.getFullYear(),r.date.getMonth()+1,1),x=0;x<=6;x++)""===y[x].text()&&(w.setDate(c),y[x].html("<span>"+c+++"</span>").addClass("nMDate"),(r.minDate&&w<g||r.maxDate&&w>f)&&y[x].addClass("disabled"),"datepicker"===r.options.mode&&w.getTime()==p.getTime()&&y[x].addClass("selected"));s.push(y)}t.each(s,function(e,a){for(var d=t("<tr></tr>"),n=a.length,e=0;e<n;e++)d.append(a[e]);i.append(d)});C="Today: "+d[r.today.getDay()]+", "+e[r.today.getMonth()]+" "+r.today.getDate()+", "+r.today.getFullYear();i.append('<tr><td colspan="7" id="today">'+C+"</td></tr>").appendTo(r.calendar)}else{this.tHead=t('<thead><tr><th id="prev">&lsaquo;</th><th colspan="2" id="currM"></th><th id="next">&rsaquo;</th></tr>'),r.tHead.find("#currM").text(r.date.getFullYear()),r.tHead.appendTo(r.calendar);for(var b=0,T=0;T<3;T++){for(var F=t("<tr></tr>"),k=0;k<4;k++){var O=t('<td align="center"></td>'),Y=t('<span class="month" num="'+b+'">'+a[b]+"</span>");O.append(Y).appendTo(F),b++}i.append(F)}var C="Today: "+d[r.today.getDay()]+", "+e[r.today.getMonth()]+" "+r.today.getDate()+", "+r.today.getFullYear();i.append('<tr><td colspan="4" id="today">'+C+"</td></tr>").appendTo(r.calendar)}}},t.fn.dcalendar=function(e){return t(this).each(function(a,d){var r=this,s=t(r),i=t(r).data("dcalendar"),o=t.extend({},t.fn.dcalendar.defaults,s.data(),"object"==typeof e&&e);i||s.data("dcalendar",i=new n(this,o)).addClass("calendar"),"string"==typeof e&&i[e]()})},t.fn.dcalendar.defaults={mode:"calendar",format:"yyyy-mm-dd"},t.fn.dcalendar.Constructor=n,t.fn.dcalendarpicker=function(e){return t(this).each(function(){var a=t(this),d=!1,n=!1,r=null;"string"==typeof e?a.next(".calendar").data("dcalendar")[e]():(r=t('<table class="calendar"></table>'),a.wrap(t('<div class="datepicker" style="position:relative;"></div>')),r.css({position:"absolute",left:0,display:"none","box-shadow":"0 4px 6px 1px rgba(0, 0, 0, 0.14)",width:"230px"}).appendTo(a.parent()),e?(e.mode="datepicker",r.dcalendar(e)):r.dcalendar({mode:"datepicker"}),r.hover(function(){d=!0},function(){d=!1}).on("click",function(){n?(n=!1,t(this).hide()):a.focus()}).on("selectdate",function(e){a.val(e.date).trigger("onchange"),a.trigger(t.Event("dateselected",{date:e.date,elem:a})),n=!0}),a.on("keydown",function(t){if(t.which)return!1}).on("focus",function(){t(".datepicker").find(".calendar").not(r).hide(),r.show()}).on("blur",function(){d||r.hide()}))})}}(jQuery);